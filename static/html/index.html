<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootstrap, from Twitter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="https://getbootstrap.com/2.3.2/assets/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="../assets/ico/favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="index.html#">业务错误码管理</a>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header"><a href="index.html#">业务错误编码</a></li>
              <li class="nav-header"><a href="module.html">业务模块码</a></li>
              <li class="nav-header"><a href="type.html">错误类型码</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div id="app" class="span9">
          <div id="bussenissCodeList" class="hero-unit row-fluid">
              <h3>业务错误码列表(<a href="#myModal" role="button" class="btn" data-toggle="modal">申请错误码</a>)</h3>
              <table>
                  <thead>
                      <tr>
                          <th>ID</th>
                          <th>业务模块</th>
                          <th>类型</th>
                          <th>业务代码</th>
                          <th>说明</th>
                          <th>状态</th>
                          <th>操作</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr v-for="item in lists.bussenissCodeList" :key="item.id">
                          <td>{{ item.id }}</td>
                          <td>{{ item.moduleCode }}</td>
                          <td>{{ item.typeCode }}</td>
                          <td>{{ item.code }}</td>
                          <td>{{ item.description }}</td>
                          <td>{{ item.status }}</td>
                          <td>  
                            <button href="#myModal" role="button" class="btn" data-toggle="modal" :data-id="item.id" @click="editBusinessCode">编辑</button>&nbsp;&nbsp;&nbsp;&nbsp;
                            <button :data-id="item.id" @click="deleteBusinessCode">失效</button>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>

          <div id="myModal" class="modal hide fade">
    
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>申请错误码</h3>
            </div>
            
            <div class="modal-body"> 
                
              <div id="saveBusinessCode">
                <div >
                    <dl>
                        <dt>业务模块<span class="required">*</span></dt>
                        <dd>
                            <select name="moduleCode" v-model="models.bussenissCode.moduleCode">
                                <option  v-for="item in lists.moduleCodeList" :key="item.id" :value="item.code">{{item.title}}</option>
                            </select>
                        </dd> 
                        <dt>错误类型<span class="required">*</span></dt>
                        <dd>
                            <select name="typeCode" v-model="models.bussenissCode.typeCode">
                                <option   v-for="item in lists.typeCodeList" :key="item.id" :value="item.code">{{item.title}}</option>
                            </select>
                        </dd>
                        <dt>名称<span class="required">*</span></dt>
                        <dd>
                            <input name="title" v-model="models.bussenissCode.title"/>
                        </dd>
                        <dt>常量标识(英文)</dt>
                        <dd>
                          <input name="title" v-model="models.bussenissCode.name"/>
                        </dd>
                        <dt>说明<span class="required">*</span></dt>
                        <dd>
                            <textarea name="description" v-model="models.bussenissCode.description">
                            </textarea>
                        </dd>
                    </dl>
                </div>
      
            </div>
                
            </div>
            
            <div class="modal-footer">
                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                <a href="#" class="btn btn-primary"  @click="saveBusinessCode" >提交</a>
            </div>
        </div>

          

        </div><!--/span-->
      </div><!--/row-->

      <hr>

      <footer>
        <p>&copy; Company 2013</p>
      </footer>

    </div><!--/.fluid-container-->

  

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/jquery.js"></script>
    <script src="../assets/js/bootstrap-modal.js"></script>
 
    <script>
      const app = new Vue({
                el: '#app',
                data:{
                    lists:{
                        bussenissCodeList:[],
                        moduleCodeList:[],
                        typeCodeList:[],
                    },
                    models:{
                        bussenissCode:{
                            id:0,
                            moduleCode:0,
                            typeCode:0,
                            name:"",
                            title:"",
                            description:"",
                            status:"",
                            createTime:"",
                            updateTime:""
                        }
                    }
                },
                created: function () {
                    axios.get('/api/v1/code/list').then((response) => {
                        this.lists.bussenissCodeList=response.data
                    });
                    axios.get('/api/v1/module/list').then((response) => {
                        this.lists.moduleCodeList=response.data
                    });
                    axios.get('/api/v1/type/list').then((response) => {
                        this.lists.typeCodeList=response.data
                    });
                },
                methods:{
                    saveBusinessCode() {
                        const model = this.models.bussenissCode
                        const url = model.id?'/api/v1/code/update':'/api/v1/code/create';
                        const method = model.id?"put":"post";
                        axios[method](url,model).then((response) => {
                            location.reload();
                        });
                        return false;

                    },
                    editBusinessCode(e) {
                        const id = e.target.dataset.id;
                        axios.get(`/api/v1/code/get?id=${id}`).then((response) => {
                            const model = response.data;
                            console.log("model", model);
                            this.models.bussenissCode=model;
                        });
                        return false;
                    },
                    deleteBusinessCode(e) {
                        const id = e.target.dataset.id;
                        axios.delete(`/api/v1/code/delete?id=${id}`).then((response) => {
                            location.reload();
                        });
                        return false;
                    }
                }
            })
    </script>
        <style >
          table{
              border-top: 1px solid #ddd;
              border-right: 1px solid #ddd;
              border-bottom: 1px solid #ddd;
          }
          tr{
              border: 1px solid #ddd; 
          }
         td{
             display: table-cell;
              border-left: 1px solid #ddd;
              border-top: 1px solid #ddd;
          }
          .th{
              background-color: #0088cc;
          }
          .required {
              color: red;
          }
      </style>
  </body>
</html>
